<!DOCTYPE html><html lang="en" class="h-full"><head><meta charSet="utf-8"/><title>Usage Billing with the Shopify Billing API</title><meta name="description" content="Implement usage based billing using the Billing API."/><meta name="viewport" content="width=device-width,initial-scale=1"/><meta property="og:type" content="website"/><meta property="og:image" content="https://workshops.shopify.dev/social-share-preview.jpg"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:image" content="https://workshops.shopify.dev/social-share-preview.jpg"/><meta name="twitter:creator" content="@ShopifyDevs"/><link rel="stylesheet" href="/build/_assets/tailwind-OSF3KDF6.css"/><link rel="stylesheet" href="/build/_assets/workshops-IXG5EJLE.css"/><link rel="stylesheet" href="/build/_assets/agate-YFU2QRW6.css"/></head><body class="h-full bg-slate-50"><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-86JJCZ26ZM"></script><script async="" id="gtag-init">
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());
              </script><main><div class="workshop flex h-full w-full flex-row justify-between gap-0"><header class="fixed top-0 left-0 right-0 z-[2] flex flex-row-reverse items-center justify-end bg-white p-4 drop-shadow-md md:justify-between"><div class="hidden md:block timer"><p>35<!-- --> minutes remaining</p></div><h1>Usage Billing with the Shopify Billing API</h1><button class="btn-icon md:hidden" aria-label="Open step navigation"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 013.75 6h16.5a.75.75 0 010 1.5H3.75A.75.75 0 013 6.75zM3 12a.75.75 0 01.75-.75h16.5a.75.75 0 010 1.5H3.75A.75.75 0 013 12zm0 5.25a.75.75 0 01.75-.75h16.5a.75.75 0 010 1.5H3.75a.75.75 0 01-.75-.75z" clip-rule="evenodd"></path></svg></button><a class="btn-icon hidden md:block" arial-label="Go back to workshops" href="/"><svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="h-5 w-5"><path d="M19 9H3.661l5.997-5.246a1 1 0 00-1.316-1.506l-8 7c-.008.007-.011.018-.019.025a.975.975 0 00-.177.24c-.018.03-.045.054-.059.087a.975.975 0 000 .802c.014.033.041.057.059.088.05.087.104.17.177.239.008.007.011.018.019.025l8 7a.996.996 0 001.411-.095 1 1 0 00-.095-1.411L3.661 11H19a1 1 0 000-2z"></path></svg></a></header>
<div class="workshop-nav flex shrink-0 flex-col gap-2 bg-slate-50"><a class="flex select-none items-center rounded-md px-4 pb-2 leading-snug md:hidden" href="/"><svg width="8.4" height="12" viewBox="0 0 7 10" fill="none" xmlns="http://www.w3.org/2000/svg" focusable="false" aria-hidden="true"><path fill-rule="evenodd" clip-rule="evenodd" d="M5.30326 0.403358C5.108 0.208096 4.79142 0.208096 4.59615 0.403358L1.06062 3.93889L0.353513 4.646C0.158251 4.84126 0.158251 5.15784 0.353513 5.35311L1.06062 6.06021L4.59615 9.59575C4.79142 9.79101 5.108 9.79101 5.30326 9.59575L6.01037 8.88864C6.20563 8.69338 6.20563 8.37679 6.01037 8.18153L2.82839 4.99955L6.01037 1.81757C6.20563 1.62231 6.20563 1.30573 6.01037 1.11046L5.30326 0.403358Z" fill="currentColor"></path></svg><span class="pl-2">Workshops</span></a><hr class="md:hidden"/><div class="flex select-none items-center rounded-md py-4 px-4 leading-snug md:hidden timer"><p>35<!-- --> minutes remaining</p></div><a href="#0" class="flex select-none items-center rounded-md border border-solid border-gray-200 bg-white py-4 px-4 leading-snug font-medium"><span class="mr-4 flex h-6 w-6 flex-none items-center justify-center rounded-full  text-[0.8rem] leading-6 text-white bg-emerald-500">1</span>Before you begin</a><a href="#1" class="flex select-none items-center rounded-md border border-solid border-gray-200 bg-white py-4 px-4 leading-snug "><span class="mr-4 flex h-6 w-6 flex-none items-center justify-center rounded-full  text-[0.8rem] leading-6 text-white bg-slate-400">2</span>Prerequisites</a><a href="#2" class="flex select-none items-center rounded-md border border-solid border-gray-200 bg-white py-4 px-4 leading-snug "><span class="mr-4 flex h-6 w-6 flex-none items-center justify-center rounded-full  text-[0.8rem] leading-6 text-white bg-slate-400">3</span>Creating a Shopify App with the Shopify CLI</a><a href="#3" class="flex select-none items-center rounded-md border border-solid border-gray-200 bg-white py-4 px-4 leading-snug "><span class="mr-4 flex h-6 w-6 flex-none items-center justify-center rounded-full  text-[0.8rem] leading-6 text-white bg-slate-400">4</span>Billing API Overview</a><a href="#4" class="flex select-none items-center rounded-md border border-solid border-gray-200 bg-white py-4 px-4 leading-snug "><span class="mr-4 flex h-6 w-6 flex-none items-center justify-center rounded-full  text-[0.8rem] leading-6 text-white bg-slate-400">5</span>Creating a Usage Based Subscription</a><a href="#5" class="flex select-none items-center rounded-md border border-solid border-gray-200 bg-white py-4 px-4 leading-snug "><span class="mr-4 flex h-6 w-6 flex-none items-center justify-center rounded-full  text-[0.8rem] leading-6 text-white bg-slate-400">6</span>Creating Usage Records</a><a href="#6" class="flex select-none items-center rounded-md border border-solid border-gray-200 bg-white py-4 px-4 leading-snug "><span class="mr-4 flex h-6 w-6 flex-none items-center justify-center rounded-full  text-[0.8rem] leading-6 text-white bg-slate-400">7</span>Prompting a Merchant to Upgrade</a><a href="#7" class="flex select-none items-center rounded-md border border-solid border-gray-200 bg-white py-4 px-4 leading-snug "><span class="mr-4 flex h-6 w-6 flex-none items-center justify-center rounded-full  text-[0.8rem] leading-6 text-white bg-slate-400">8</span>Subscribing to Webhooks</a><a href="#8" class="flex select-none items-center rounded-md border border-solid border-gray-200 bg-white py-4 px-4 leading-snug "><span class="mr-4 flex h-6 w-6 flex-none items-center justify-center rounded-full  text-[0.8rem] leading-6 text-white bg-slate-400">9</span>Conclusion</a></div><div class="backdrop fixed inset-0"></div>
<div class="slider-wrapper"><div class="slider-panel"><div class="workshop-step"><section><h2 id="0">Before you begin</h2><p>In this workshop we will be adding a usage based billing workflow to the app template generated by the Shopify CLI. This workshop will use the app template using Node.js for the backend and React for the frontend. Usage based billing will allow you to charge merchants based off of how much they use your app, or use certain features within your app.</p><p>After completing this workshop you will have experience with:</p><ul>
<li>Using the Shopify API library to prompt users to accept a Usage Based subscription on install</li>
<li>Create Usage Records to increase the amount a merchants will be charged</li>
<li>Prompt a merchant to increase their plan if they reach their usage limit</li>
<li>Subscribe to webhooks to be notified about changes to a merchant&#x27;s subscription</li>
</ul><aside class="callout callout-positive border-green-500 bg-green-50 rounded-md border-l-4  p-4"><dt>Positive</dt><dd>Reference the <a href="https://github.com/Shopify/usage-billing-example-shopify-app">completed code repository</a></dd></aside></section></div></div><div class="slider-controls"><button class="slider-control btn btn-small btn-tertiary-outline prev shadow-md invisible" disabled="">Back</button><button class="slider-control btn btn-small btn-tertiary next shadow-md ">Next</button></div></div></div></main><script>((STORAGE_KEY, restoreKey) => {
    if (!window.history.state || !window.history.state.key) {
      let key = Math.random().toString(32).slice(2);
      window.history.replaceState({
        key
      }, "");
    }
    try {
      let positions = JSON.parse(sessionStorage.getItem(STORAGE_KEY) || "{}");
      let storedY = positions[restoreKey || window.history.state.key];
      if (typeof storedY === "number") {
        window.scrollTo(0, storedY);
      }
    } catch (error) {
      console.error(error);
      sessionStorage.removeItem(STORAGE_KEY);
    }
  })("positions", null)</script><link rel="modulepreload" href="/build/entry.client-J6TYPMOL.js"/><link rel="modulepreload" href="/build/_shared/chunk-YZBVNK3V.js"/><link rel="modulepreload" href="/build/_shared/chunk-SH7JW3YP.js"/><link rel="modulepreload" href="/build/_shared/chunk-GDLBX7ER.js"/><link rel="modulepreload" href="/build/_shared/chunk-Q3IECNXJ.js"/><link rel="modulepreload" href="/build/_shared/chunk-JOBPDGDE.js"/><link rel="modulepreload" href="/build/_shared/chunk-MV3Y6IQI.js"/><link rel="modulepreload" href="/build/root-TS7GWK7I.js"/><link rel="modulepreload" href="/build/routes/workshops-YWZAAF22.js"/><link rel="modulepreload" href="/build/_shared/chunk-4QTFVEPO.js"/><link rel="modulepreload" href="/build/routes/workshops/$workshopId-TCVFMZD7.js"/><script>window.__remixContext = {"url":"/workshops/usage-billing","state":{"loaderData":{"root":{"trackingEnabled":true},"routes/workshops/$workshopId":{"workshopId":"usage-billing","code":"var Component=(()=\u003e{var d=Object.create;var r=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var j=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var y=(a,e)=\u003e()=\u003e(e||a((e={exports:{}}).exports,e),e.exports),g=(a,e)=\u003e{for(var l in e)r(a,l,{get:e[l],enumerable:!0})},i=(a,e,l,c)=\u003e{if(e\u0026\u0026typeof e==\"object\"||typeof e==\"function\")for(let n of u(e))!N.call(a,n)\u0026\u0026n!==l\u0026\u0026r(a,n,{get:()=\u003ee[n],enumerable:!(c=m(e,n))||c.enumerable});return a};var f=(a,e,l)=\u003e(l=a!=null?d(j(a)):{},i(e||!a||!a.__esModule?r(l,\"default\",{value:a,enumerable:!0}):l,a)),w=a=\u003ei(r({},\"__esModule\",{value:!0}),a);var h=y((A,t)=\u003e{t.exports=_jsx_runtime});var I={};g(I,{default:()=\u003e_,frontmatter:()=\u003eb});var s=f(h()),b={id:\"usage-billing\",title:\"Usage Billing with the Shopify Billing API\",summary:\"Implement usage based billing using the Billing API.\",status:\"Published\",categories:\"shopify\"};function o(a){let e=Object.assign({timer:\"timer\",h1:\"h1\",nav:\"nav\",\"workshop-steps\":\"workshop-steps\",div:\"div\",section:\"section\",h2:\"h2\",p:\"p\",ul:\"ul\",li:\"li\",dl:\"dl\",dt:\"dt\",dd:\"dd\",a:\"a\",pre:\"pre\",code:\"code\",img:\"img\",h3:\"h3\",span:\"span\"},a.components),l=e[\"workshop-steps\"],{WorkshopHeader:c,WorkshopNavLink:n}=e;return c||p(\"WorkshopHeader\",!0),n||p(\"WorkshopNavLink\",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(c,{children:[(0,s.jsx)(e.timer,{cssClass:\"hidden md:block\",children:'{\"total\":35,\"stepsDuration\":{\"3\":5,\"4\":5,\"5\":10,\"6\":5,\"7\":5,\"8\":5},\"countDown\":[]}'}),(0,s.jsx)(e.h1,{children:\"Usage Billing with the Shopify Billing API\"})]}),`\n`,(0,s.jsxs)(e.nav,{children:[(0,s.jsx)(e.timer,{cssClass:\"flex select-none items-center rounded-md py-4 px-4 leading-snug md:hidden\",children:'{\"total\":35,\"stepsDuration\":{\"3\":5,\"4\":5,\"5\":10,\"6\":5,\"7\":5,\"8\":5},\"countDown\":[]}'}),(0,s.jsx)(n,{stepStr:\"0\",children:\"Before you begin\"}),(0,s.jsx)(n,{stepStr:\"1\",children:\"Prerequisites\"}),(0,s.jsx)(n,{stepStr:\"2\",children:\"Creating a Shopify App with the Shopify CLI\"}),(0,s.jsx)(n,{stepStr:\"3\",children:\"Billing API Overview\"}),(0,s.jsx)(n,{stepStr:\"4\",children:\"Creating a Usage Based Subscription\"}),(0,s.jsx)(n,{stepStr:\"5\",children:\"Creating Usage Records\"}),(0,s.jsx)(n,{stepStr:\"6\",children:\"Prompting a Merchant to Upgrade\"}),(0,s.jsx)(n,{stepStr:\"7\",children:\"Subscribing to Webhooks\"}),(0,s.jsx)(n,{stepStr:\"8\",children:\"Conclusion\"})]}),`\n`,(0,s.jsxs)(l,{children:[(0,s.jsx)(e.div,{className:\"workshop-step\",children:(0,s.jsxs)(e.section,{children:[(0,s.jsx)(e.h2,{id:\"0\",children:\"Before you begin\"}),(0,s.jsx)(e.p,{children:\"In this workshop we will be adding a usage based billing workflow to the app template generated by the Shopify CLI. This workshop will use the app template using Node.js for the backend and React for the frontend. Usage based billing will allow you to charge merchants based off of how much they use your app, or use certain features within your app.\"}),(0,s.jsx)(e.p,{children:\"After completing this workshop you will have experience with:\"}),(0,s.jsxs)(e.ul,{children:[`\n`,(0,s.jsx)(e.li,{children:\"Using the Shopify API library to prompt users to accept a Usage Based subscription on install\"}),`\n`,(0,s.jsx)(e.li,{children:\"Create Usage Records to increase the amount a merchants will be charged\"}),`\n`,(0,s.jsx)(e.li,{children:\"Prompt a merchant to increase their plan if they reach their usage limit\"}),`\n`,(0,s.jsx)(e.li,{children:\"Subscribe to webhooks to be notified about changes to a merchant's subscription\"}),`\n`]}),(0,s.jsxs)(e.dl,{children:[(0,s.jsx)(e.dt,{children:\"Positive\"}),(0,s.jsxs)(e.dd,{children:[\"Reference the \",(0,s.jsx)(e.a,{href:\"https://github.com/Shopify/usage-billing-example-shopify-app\",children:\"completed code repository\"})]})]})]})}),(0,s.jsx)(e.div,{className:\"workshop-step\",children:(0,s.jsxs)(e.section,{children:[(0,s.jsx)(e.h2,{id:\"1\",children:\"Prerequisites\"}),(0,s.jsxs)(e.ul,{children:[`\n`,(0,s.jsxs)(e.li,{children:[\"Create a \",(0,s.jsx)(e.a,{href:\"https://www.shopify.com/partners\",children:\"Shopify partner account\"})]}),`\n`,(0,s.jsxs)(e.li,{children:[\"Create a \",(0,s.jsx)(e.a,{href:\"https://shopify.dev/docs/apps/tools/development-stores#create-a-development-store-to-test-your-app\",children:\"development store with pre-ppopulated data\"})]}),`\n`,(0,s.jsxs)(e.li,{children:[\"Sign up for a \",(0,s.jsx)(e.a,{href:\"https://ngrok.com/\",children:\"ngrok account\"})]}),`\n`,(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:\"https://nodejs.org/en/download/\",children:\"Installed Node 18\"}),\" or higher\"]}),`\n`]}),(0,s.jsxs)(e.ul,{children:[`\n`,(0,s.jsxs)(e.li,{children:[\"Installed a Node package manager such as \",(0,s.jsx)(e.a,{href:\"https://docs.npmjs.com/downloading-and-installing-node-js-and-npm\",children:\"npm\"}),\", \",(0,s.jsx)(e.a,{href:\"https://classic.yarnpkg.com/lang/en/docs/install/#mac-stable\",children:\"yarn\"}),\", or \",(0,s.jsx)(e.a,{href:\"https://pnpm.io/installation\",children:\"pnpm\"}),\".\"]}),`\n`]}),(0,s.jsxs)(e.ul,{children:[`\n`,(0,s.jsxs)(e.li,{children:[\"Install \",(0,s.jsx)(e.a,{href:\"https://git-scm.com/book/en/v2/Getting-Started-Installing-Git\",children:\"Git\"})]}),`\n`,(0,s.jsx)(e.li,{children:\"Installed the latest version of Chrome or Firefox\"}),`\n`,(0,s.jsxs)(e.li,{children:[\"Install a text editor such as \",(0,s.jsx)(e.a,{href:\"https://code.visualstudio.com/\",children:\"Visual Studio Code\"})]}),`\n`]})]})}),(0,s.jsx)(e.div,{className:\"workshop-step\",children:(0,s.jsxs)(e.section,{children:[(0,s.jsx)(e.h2,{id:\"2\",children:\"Creating a Shopify App with the Shopify CLI\"}),(0,s.jsx)(e.p,{children:\"In this section we will be covering how to generate your first app. If you already have a Shopify app you would like to add usage billing to you can skip this section.\"}),(0,s.jsx)(e.p,{children:\"In your terminal run the following command to clone the generated code for a Shopify app, and give your app a name.\"}),(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:\"hljs language-bash\",children:`npm init @shopify/app@latest\n`})}),(0,s.jsxs)(e.p,{children:[\"When you create an app using these commands, a new Shopify project directory is created, template code is cloned, and Shopify CLI is installed along with all of the dependencies you need to build Shopify apps. The current version of Shopify CLI is also added as a dependency in your project's \",(0,s.jsx)(e.code,{children:\"package.json\"}),\".\"]}),(0,s.jsx)(e.p,{children:\"The new app contains the following template elements:\"}),(0,s.jsxs)(e.ul,{children:[`\n`,(0,s.jsx)(e.li,{children:\"A React.js frontend that lets you populate your development store with products\"}),`\n`,(0,s.jsx)(e.li,{children:\"A Node.js backend that is ready to interact with the Shopify REST and GraphQL Admin APIs\"}),`\n`]}),(0,s.jsx)(e.p,{children:\"From your apps root directory run the following command to start your app server.\"}),(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:\"hljs language-bash\",children:`npm run dev\n`})}),(0,s.jsx)(e.p,{children:\"The first time you run this command it will require you to do some additional setup.\"}),(0,s.jsxs)(e.p,{children:[\"When prompted with \",(0,s.jsx)(e.code,{children:\"Create this project as a new app on Shopify?\"}),`\nSelect `,(0,s.jsx)(e.code,{children:\"Yes, create it as a new app\"}),`.\nThis will create the App in your Shopify Partners account.\nIf you have more than one development store associated with your partner account you'll be asked to choose which development store you'd like to install your app on.`]}),(0,s.jsxs)(e.p,{children:[\"You will be prompted \",(0,s.jsx)(e.code,{children:\"Have Shopify automatically update your app's URL in order to create a preview experience?\"}),`\nFor this workshop we will select `,(0,s.jsx)(e.code,{children:\"Yes\"}),\". When you restart your server, your ngrok tunnel may change. Selecting \",(0,s.jsx)(e.code,{children:\"Yes\"}),\" will automatically update your app's URL in your Shopify Partners account.\"]})]})}),(0,s.jsx)(e.div,{className:\"workshop-step\",children:(0,s.jsxs)(e.section,{children:[(0,s.jsx)(e.h2,{id:\"3\",children:\"Billing API Overview\"}),(0,s.jsx)(e.p,{children:\"The Shopify Billing API allows you to create and manage app subscriptions for merchants. The merchants will be charged through Shopify's invoicing system.\"}),(0,s.jsx)(e.p,{children:\"The Billing API has the benefits of:\"}),(0,s.jsxs)(e.ul,{children:[`\n`,(0,s.jsx)(e.li,{children:\"Charges appear directly on the merchant's Shopify invoice, so merchants don't have to enter their credit card information to pay for apps.\"}),`\n`,(0,s.jsx)(e.li,{children:\"Apps that use Shopify's Billing API have higher free-to-paid conversion rates because charges originate directly from Shopify.\"}),`\n`,(0,s.jsx)(e.li,{children:\"You automatically receive a revenue share from Shopify. Your share of the revenue is defined in the Shopify Partner revenue share agreement.\"}),`\n`,(0,s.jsx)(e.li,{children:\"Shopify handles all chargebacks.\"}),`\n`]}),(0,s.jsx)(e.p,{children:\"The Billing API is mandatory for all apps that are distributed through the Shopify App Store that want to charge merchants, unless you have been notified by Shopify.\"}),(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:\"/content/images/usage-billing/billing-flow-diagram.png\",alt:\"Billing Flow Diagram\"})}),(0,s.jsx)(e.h3,{children:\"Usage Based Billing\"}),(0,s.jsx)(e.p,{children:\"Usage based billing allows you to charge merchants based off of how much they use your app, or certain features within your app. Usage based billing is only available to be charged on a 30 day basis.\"}),(0,s.jsx)(e.p,{children:\"When accepting the subscription the merchant will be shown the maximum amount they will be charged per 30 days. The merchant will also be shown the usage terms, which is a description of what the merchant will be charged for. The merchant will be able to accept or decline the subscription.\"})]})}),(0,s.jsx)(e.div,{className:\"workshop-step\",children:(0,s.jsxs)(e.section,{children:[(0,s.jsx)(e.h2,{id:\"4\",children:\"Creating a Usage Based Subscription\"}),(0,s.jsx)(e.p,{children:\"In this section we will be covering how to create a usage based subscription.\"}),(0,s.jsx)(e.h3,{children:\"Create a App Subscription on Install\"}),(0,s.jsx)(e.p,{children:\"For this application we will be directing a merchant to accept a subscription usage charge on app install. This is not required when using the billing API. You can prompt a merchant to accept a subscription at any time. Another common flow is to have a Plan Page in your application that allows a merchant to accept a subscription, this may be a better flow for your application if you have multiple billing plans.\"}),(0,s.jsx)(e.h3,{children:\"Adding Middleware to the App\"}),(0,s.jsx)(e.p,{children:\"Open the cloned app template in your text editor.\"}),(0,s.jsxs)(e.p,{children:[\"Create a new file name \",(0,s.jsx)(e.code,{children:\"billing.js\"}),\" in the \",(0,s.jsx)(e.code,{children:\"web\"}),\" directory, and paste the following code into the file.\"]}),(0,s.jsx)(e.pre,{children:(0,s.jsxs)(e.code,{className:\"hljs language-javascript\",children:[(0,s.jsx)(e.span,{className:\"hljs-comment\",children:\"// web/billing.js\"}),`\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"import\"}),\" { \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"BillingInterval\"}),\" } \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"from\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"@shopify/shopify-api\"'}),`;\n\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"export\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),` billingConfig = {\n  `,(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"My plan\"'}),`: {\n    `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"amount\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-number\",children:\"5.0\"}),`,\n    `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"currencyCode\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"USD\"'}),`,\n    `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"interval\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"BillingInterval\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"Usage\"}),`,\n    `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"usageTerms\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"One dollar per button click\"'}),`,\n  },\n};\n`]})}),(0,s.jsxs)(e.p,{children:[\"We will be passing this object to \",(0,s.jsx)(e.a,{href:\"https://github.com/Shopify/shopify-app-js/blob/main/packages/shopify-app-express/docs/reference/shopifyApp.md\",children:\"Shopify App object\"}),\" to create a new subscription plan. The \",(0,s.jsx)(e.code,{children:\"amount\"}),\" is the maximum amount you will charge the merchant per 30 days. The \",(0,s.jsx)(e.code,{children:\"currencyCode\"}),\" is the currency you will charge the merchant in. The \",(0,s.jsx)(e.code,{children:\"interval\"}),\" is the billing interval, which in this case is \",(0,s.jsx)(e.code,{children:\"Usage\"}),\". The \",(0,s.jsx)(e.code,{children:\"usageTerms\"}),\" is a description of how the merchant will be charged, this string is displayed to the merchant when they are prompted to accept the subscription.\"]}),(0,s.jsxs)(e.p,{children:[\"Open the \",(0,s.jsx)(e.code,{children:\"shopify.js\"}),\" file in the \",(0,s.jsx)(e.code,{children:\"web\"}),\" directory.\"]}),(0,s.jsxs)(e.p,{children:[\"Import the \",(0,s.jsx)(e.code,{children:\"billingConfig\"}),\" object from the \",(0,s.jsx)(e.code,{children:\"billing.js\"}),\" file.\"]}),(0,s.jsx)(e.pre,{children:(0,s.jsxs)(e.code,{className:\"hljs language-javascript\",children:[(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"import\"}),\" { billingConfig } \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"from\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"./billing.js\"'}),`;\n`]})}),(0,s.jsxs)(e.p,{children:[\"Delete the previously define \",(0,s.jsx)(e.code,{children:\"billingConfig\"}),\" object.\"]}),(0,s.jsxs)(e.p,{children:[\"And set the \",(0,s.jsx)(e.code,{children:\"billing\"}),\" key to the \",(0,s.jsx)(e.code,{children:\"billingConfig\"}),\" object.\"]}),(0,s.jsxs)(e.p,{children:[\"The \",(0,s.jsx)(e.code,{children:\"shopify.js\"}),\" file should now look like this.\"]}),(0,s.jsx)(e.pre,{children:(0,s.jsxs)(e.code,{className:\"hljs language-javascript\",children:[(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"import\"}),\" { \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"BillingInterval\"}),\", \",(0,s.jsx)(e.span,{className:\"hljs-variable constant_\",children:\"LATEST_API_VERSION\"}),\" } \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"from\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"@shopify/shopify-api\"'}),`;\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"import\"}),\" { shopifyApp } \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"from\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"@shopify/shopify-app-express\"'}),`;\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"import\"}),\" { \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"SQLiteSessionStorage\"}),\" } \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"from\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"@shopify/shopify-app-session-storage-sqlite\"'}),`;\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"let\"}),\" { restResources } = \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"await\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"import\"}),`(\n  `,(0,s.jsxs)(e.span,{className:\"hljs-string\",children:[\"`@shopify/shopify-api/rest/admin/\",(0,s.jsx)(e.span,{className:\"hljs-subst\",children:\"${LATEST_API_VERSION}\"}),\"`\"]}),`\n);\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"import\"}),\" { billingConfig } \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"from\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"./billing.js\"'}),`;\n`,(0,s.jsx)(e.span,{className:\"hljs-comment\",children:\"// If you want IntelliSense for the rest resources, you should import them directly\"}),`\n`,(0,s.jsx)(e.span,{className:\"hljs-comment\",children:'// import { restResources } from \"@shopify/shopify-api/rest/admin/2022-10\";'}),`\n\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-variable constant_\",children:\"DB_PATH\"}),\" = \",(0,s.jsxs)(e.span,{className:\"hljs-string\",children:[\"`\",(0,s.jsx)(e.span,{className:\"hljs-subst\",children:\"${process.cwd()}\"}),\"/database.sqlite`\"]}),`;\n\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" shopify = \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"shopifyApp\"}),`({\n  `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"api\"}),`: {\n    `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"apiVersion\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-variable constant_\",children:\"LATEST_API_VERSION\"}),`,\n    restResources,\n    `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"billing\"}),\": billingConfig, \",(0,s.jsx)(e.span,{className:\"hljs-comment\",children:\"// or replace with billingConfig above to enable example billing\"}),`\n  },\n  `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"auth\"}),`: {\n    `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"path\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"/api/auth\"'}),`,\n    `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"callbackPath\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"/api/auth/callback\"'}),`,\n  },\n  `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"webhooks\"}),`: {\n    `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"path\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"/api/webhooks\"'}),`,\n  },\n  `,(0,s.jsx)(e.span,{className:\"hljs-comment\",children:\"// This should be replaced with your preferred storage strategy\"}),`\n  `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"sessionStorage\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"new\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"SQLiteSessionStorage\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-variable constant_\",children:\"DB_PATH\"}),`),\n});\n\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"export\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"default\"}),` shopify;\n`]})}),(0,s.jsxs)(e.p,{children:[\"Open the \",(0,s.jsx)(e.code,{children:\"index.js\"}),\" file in the \",(0,s.jsx)(e.code,{children:\"web\"}),\" directory.\"]}),(0,s.jsx)(e.p,{children:\"We will be adding middleware to check if the app has a valid subscription, and if not redirect the merchant to the billing page.\"}),(0,s.jsxs)(e.p,{children:[\"Add the following anonymous function to be called after \",(0,s.jsx)(e.code,{children:\"shopify.auth.callback(),\"}),\". And import the billing config object we created.\"]}),(0,s.jsx)(e.pre,{children:(0,s.jsxs)(e.code,{className:\"hljs language-javascript\",children:[(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"import\"}),\" { billingConfig } \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"from\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"./billing.js\"'}),`;\n`]})}),(0,s.jsx)(e.pre,{children:(0,s.jsxs)(e.code,{className:\"hljs language-javascript\",children:[(0,s.jsx)(e.span,{className:\"hljs-comment\",children:\"// Request payment if required\"}),`\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"async\"}),` (req, res, next) =\u003e {\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" plans = \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"Object\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"keys\"}),`(billingConfig);\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" session = res.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"locals\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"shopify\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"session\"}),`;\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" hasPayment = \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"await\"}),\" shopify.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"api\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"billing\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"check\"}),`({\n      session,\n      `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"plans\"}),`: plans,\n      `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"isTest\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"true\"}),`,\n    });\n\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"if\"}),` (hasPayment) {\n      `,(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"next\"}),`();\n    } `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"else\"}),` {\n      res.`,(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"redirect\"}),`(\n        `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"await\"}),\" shopify.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"api\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"billing\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"request\"}),`({\n          session,\n          `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"plan\"}),\": plans[\",(0,s.jsx)(e.span,{className:\"hljs-number\",children:\"0\"}),`],\n          `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"isTest\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"true\"}),`,\n        }),\n      );\n    }\n  },\n`]})}),(0,s.jsxs)(e.p,{children:[\"The authentication code in the \",(0,s.jsx)(e.code,{children:\"index.js\"}),\" file should now look like this.\"]}),(0,s.jsx)(e.pre,{children:(0,s.jsxs)(e.code,{className:\"hljs language-javascript\",children:[(0,s.jsx)(e.span,{className:\"hljs-comment\",children:\"// Set up Shopify authentication and webhook handling\"}),`\napp.`,(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"get\"}),\"(shopify.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"config\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"auth\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"path\"}),\", shopify.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"auth\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"begin\"}),`());\napp.`,(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"get\"}),`(\n  shopify.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"config\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"auth\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"callbackPath\"}),`,\n  shopify.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"auth\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"callback\"}),`(),\n  `,(0,s.jsx)(e.span,{className:\"hljs-comment\",children:\"// Request payment if required\"}),`\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"async\"}),` (req, res, next) =\u003e {\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" plans = \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"Object\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"keys\"}),`(billingConfig);\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" session = res.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"locals\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"shopify\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"session\"}),`;\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" hasPayment = \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"await\"}),\" shopify.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"api\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"billing\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"check\"}),`({\n      session,\n      `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"plans\"}),`: plans,\n      `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"isTest\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"true\"}),`,\n    });\n\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"if\"}),` (hasPayment) {\n      `,(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"next\"}),`();\n    } `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"else\"}),` {\n      res.`,(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"redirect\"}),`(\n        `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"await\"}),\" shopify.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"api\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"billing\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"request\"}),`({\n          session,\n          `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"plan\"}),\": plans[\",(0,s.jsx)(e.span,{className:\"hljs-number\",children:\"0\"}),`],\n          `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"isTest\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"true\"}),`,\n        })\n      );\n    }\n  },\n  `,(0,s.jsx)(e.span,{className:\"hljs-comment\",children:\"// Load the app otherwise\"}),`\n  shopify.`,(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"redirectToShopifyOrAppRoot\"}),`()\n);\n`]})}),(0,s.jsxs)(e.p,{children:[\"This new function will check if the merchant has a valid subscription, and if not redirect them to the billing page, using the plan configured in \",(0,s.jsx)(e.code,{children:\"billing.js\"}),\".\"]}),(0,s.jsxs)(e.p,{children:[\"This function uses helper functions \",(0,s.jsx)(e.code,{children:\"billing.check\"}),\" and \",(0,s.jsx)(e.code,{children:\"billing.request\"}),\" from the \",(0,s.jsx)(e.a,{href:\"https://github.com/Shopify/shopify-api-js/blob/main/docs/reference/billing/README.md\",children:\"Shopify Node API\"}),\".\"]}),(0,s.jsx)(e.h3,{children:\"Select Public App Distribution\"}),(0,s.jsx)(e.p,{children:\"Only public apps can use the billing API. If you have not already selected public app distribution, you can do so in the App section of the Shopify Partner Dashboard.\"}),(0,s.jsx)(e.p,{children:\"Choosing public app distribution will allow you to eventually distribute your app to the Shopify App Store.\"}),(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:\"/content/images/optimized/usage-billing/public-distribution.jpg\",alt:\"public-distribution\"})}),(0,s.jsx)(e.h3,{children:\"Test your App\"}),(0,s.jsx)(e.p,{children:\"We can now test our app to see if we will be redirected to accept a subscription on install.\"}),(0,s.jsxs)(e.p,{children:[\"If you have already installed the app on your dev store you can uninstall it from your Shopify admin in \",(0,s.jsx)(e.code,{children:\"Apps\"}),\" \u003e \",(0,s.jsx)(e.code,{children:\"Apps and Sales Channels Settings\"}),\" \u003e \",(0,s.jsx)(e.code,{children:\"Remove\"}),\".\"]}),(0,s.jsxs)(e.p,{children:[\"You can install your app by clicking the install link that was output when you ran \",(0,s.jsx)(e.code,{children:\"npm run dev\"}),\" in the terminal.\"]}),(0,s.jsx)(e.p,{children:\"After approving the scopes, you should be redirected to the billing page. After approving the test charge you are then directed to the apps home page.\"}),(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:\"/content/images/optimized/usage-billing/approve-charge.jpg\",alt:\"accept-charge\"})}),(0,s.jsxs)(e.dl,{children:[(0,s.jsx)(e.dt,{children:\"Negative\"}),(0,s.jsx)(e.dd,{children:\"On development stores, test or simulated charges will be created. No credit card will be charged.\"})]})]})}),(0,s.jsx)(e.div,{className:\"workshop-step\",children:(0,s.jsxs)(e.section,{children:[(0,s.jsx)(e.h2,{id:\"5\",children:\"Creating Usage Records\"}),(0,s.jsx)(e.p,{children:\"The core of usage based billing is that merchants will only be charged for what they use. In this example we will be creating a usage record, and incrementing by a fixed amount what is owed by a merchant each time they use the feature. Your app could use a different strategy to charge a merchant that is more appropriate for your use case. Examples could include:\"}),(0,s.jsxs)(e.ul,{children:[`\n`,(0,s.jsx)(e.li,{children:\"Charging 10 dollars for 100 emails, a usage record could be created on the 1st and 101st email sent.\"}),`\n`,(0,s.jsx)(e.li,{children:\"Charging a percentage of an order value for each order your app was used on, a usage record could be created on each order.\"}),`\n`]}),(0,s.jsxs)(e.dl,{children:[(0,s.jsx)(e.dt,{children:\"Positive\"}),(0,s.jsx)(e.dd,{children:'In this example we will be creating a usage record in line of the API call to \"use the feature\". In a production app you may want to batch these calls in a deferred job.'})]}),(0,s.jsx)(e.h3,{children:\"Update the App UI\"}),(0,s.jsx)(e.p,{children:\"We will be adding a button to the app UI that will be used to create a usage record.\"}),(0,s.jsxs)(e.p,{children:[\"In the \",(0,s.jsx)(e.code,{children:\"web/frontend/components\"}),\" directory create a new file called \",(0,s.jsx)(e.code,{children:\"PaidFeature.jsx\"}),\".\"]}),(0,s.jsx)(e.p,{children:\"Add the following code to this file\"}),(0,s.jsx)(e.pre,{children:(0,s.jsxs)(e.code,{className:\"hljs language-javascript\",children:[(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"import\"}),\" { useState } \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"from\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"react\"'}),`;\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"import\"}),\" { \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"Card\"}),\" } \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"from\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"@shopify/polaris\"'}),`;\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"import\"}),\" { \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"Toast\"}),\" } \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"from\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"@shopify/app-bridge-react\"'}),`;\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"import\"}),\" { useAuthenticatedFetch } \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"from\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"../hooks\"'}),`;\n\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"export\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"function\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"PaidFeature\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-params\"}),`) {\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" [isLoading, setIsLoading] = \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"useState\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"false\"}),`);\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" [toastProps, setToastProps] = \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"useState\"}),\"({ \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"content\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"null\"}),` });\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" fetch = \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"useAuthenticatedFetch\"}),`();\n\n  `,(0,s.jsx)(e.span,{className:\"hljs-comment\",children:`/*\n   * This will use the authenticated fetch hook to make a request to our server\n   * to create a usage record. If the usage record is created successfully, we\n   * will set the toastProps to display a success message. If the usage record\n   * is not created successfully, we will set the toastProps to display an error\n   * If the usage record is not created successfully because the capacity has\n   * been reached, we will set the capacityReached state to true so that the\n   * button is disabled.\n   */`}),`\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"handleCreateUsageRecord\"}),\" = \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"async\"}),\" (\",(0,s.jsx)(e.span,{className:\"hljs-params\"}),`) =\u003e {\n    `,(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"setIsLoading\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"true\"}),`);\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" response = \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"await\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"fetch\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"/api/usage/create\"'}),`);\n    `,(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"setIsLoading\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"false\"}),`);\n\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"if\"}),\" (response.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"ok\"}),`) {\n      `,(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"setToastProps\"}),\"({ \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"content\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"Usage record created!\"'}),` });\n    } `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"else\"}),` {\n      `,(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"setToastProps\"}),`({\n        `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"content\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"There was an error creating usage record\"'}),`,\n        `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"error\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"true\"}),`,\n      });\n    }\n  };\n\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" toastMarkup = toastProps.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"content\"}),` \u0026\u0026 (\n    `,(0,s.jsxs)(e.span,{className:\"xml\",children:[(0,s.jsxs)(e.span,{className:\"hljs-tag\",children:[\"\u003c\",(0,s.jsx)(e.span,{className:\"hljs-name\",children:\"Toast\"}),\" {\",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"...toastProps\"}),\"} \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"onDismiss\"}),\"=\",(0,s.jsx)(e.span,{className:\"hljs-string\",children:\"{()\"}),\" =\u003e\"]}),\" setToastProps({ content: null })} /\u003e\"]}),`\n  );\n\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"return\"}),` (\n    `,(0,s.jsxs)(e.span,{className:\"xml\",children:[(0,s.jsx)(e.span,{className:\"hljs-tag\",children:\"\u003c\u003e\"}),`\n      {toastMarkup}\n      `,(0,s.jsxs)(e.span,{className:\"hljs-tag\",children:[\"\u003c\",(0,s.jsx)(e.span,{className:\"hljs-name\",children:\"Card\"}),`\n        `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"title\"}),\"=\",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"Usage Billing\"'}),`\n        `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"sectioned\"}),`\n        `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"primaryFooterAction\"}),\"=\",(0,s.jsx)(e.span,{className:\"hljs-string\",children:\"{{\"}),`\n          `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"content:\"}),' \"',(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"Create\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"Usage\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"Record\"}),`\",\n          `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"onAction:\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"handleCreateUsageRecord\"}),`,\n          `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"loading:\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"isLoading\"}),`,\n        }}\n      \u003e`]}),`\n        `,(0,s.jsxs)(e.span,{className:\"hljs-tag\",children:[\"\u003c\",(0,s.jsx)(e.span,{className:\"hljs-name\",children:\"p\"}),\"\u003e\"]}),\"Use this feature! (Will be charged for usage)\",(0,s.jsxs)(e.span,{className:\"hljs-tag\",children:[\"\u003c/\",(0,s.jsx)(e.span,{className:\"hljs-name\",children:\"p\"}),\"\u003e\"]}),`\n      `,(0,s.jsxs)(e.span,{className:\"hljs-tag\",children:[\"\u003c/\",(0,s.jsx)(e.span,{className:\"hljs-name\",children:\"Card\"}),\"\u003e\"]}),`\n    `,(0,s.jsx)(e.span,{className:\"hljs-tag\",children:\"\u003c/\u003e\"})]}),`\n  );\n}\n`]})}),(0,s.jsx)(e.p,{children:\"This code\"}),(0,s.jsxs)(e.ul,{children:[`\n`,(0,s.jsx)(e.li,{children:\"Uses a Polaris Card component to display text and a button to trigger the creation of a usage record.\"}),`\n`,(0,s.jsx)(e.li,{children:\"Uses an App Bridge Toast component to display a success or error message after the usage record is created.\"}),`\n`,(0,s.jsxs)(e.li,{children:[\"Uses the \",(0,s.jsx)(e.code,{children:\"useAuthenticatedFetch\"}),\" hook to make a request authenticated with session tokens to our server to create a usage record.\"]}),`\n`]}),(0,s.jsxs)(e.p,{children:[\"Add the following line to \",(0,s.jsx)(e.code,{children:\"web/frontend/components/index.js\"}),\" to export the \",(0,s.jsx)(e.code,{children:\"PaidFeature\"}),\" component.\"]}),(0,s.jsx)(e.pre,{children:(0,s.jsxs)(e.code,{className:\"hljs language-javascript\",children:[(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"export\"}),\" { \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"PaidFeature\"}),\" } \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"from\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"./PaidFeature\"'}),`;\n`]})}),(0,s.jsxs)(e.p,{children:[\"Add the \",(0,s.jsx)(e.code,{children:\"PaidFeature\"}),\" component to the \",(0,s.jsx)(e.code,{children:\"web/frontend/pages/index.jsx\"}),\" file.\"]}),(0,s.jsx)(e.pre,{children:(0,s.jsxs)(e.code,{className:\"hljs language-javascript\",children:[(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"import\"}),\" { \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"PaidFeature\"}),\", \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"ProductsCard\"}),\" } \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"from\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"../components\"'}),`;\n`]})}),(0,s.jsx)(e.pre,{children:(0,s.jsxs)(e.code,{className:\"hljs language-javascript\",children:[(0,s.jsx)(e.span,{className:\"hljs-comment\",children:\"// ...\"}),`\n\u003c`,(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"Layout\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"Section\"}),`\u003e\n  `,(0,s.jsx)(e.span,{className:\"xml\",children:(0,s.jsxs)(e.span,{className:\"hljs-tag\",children:[\"\u003c\",(0,s.jsx)(e.span,{className:\"hljs-name\",children:\"PaidFeature\"}),\" /\u003e\"]})}),`\n  `,(0,s.jsx)(e.span,{className:\"xml\",children:(0,s.jsxs)(e.span,{className:\"hljs-tag\",children:[\"\u003c\",(0,s.jsx)(e.span,{className:\"hljs-name\",children:\"ProductsCard\"}),\" /\u003e\"]})}),`\n\u003c/`,(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"Layout\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"Section\"}),`\u003e\n`,(0,s.jsx)(e.span,{className:\"hljs-comment\",children:\"// ...\"}),`\n`]})}),(0,s.jsx)(e.h3,{children:\"Creating Usage Records with Shopify API\"}),(0,s.jsxs)(e.p,{children:[\"In the \",(0,s.jsx)(e.code,{children:\"web/billing.js\"}),\" file add the following GraphQL mutation that will be used to create a usage record.\"]}),(0,s.jsx)(e.pre,{children:(0,s.jsxs)(e.code,{className:\"hljs language-javascript\",children:[(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-variable constant_\",children:\"CREATE_USAGE_RECORD\"}),\" = \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:`\\`\nmutation appUsageRecordCreate($subscriptionLineItemId: ID!, $amount: Decimal!, $description: String!){\n    appUsageRecordCreate(\n      subscriptionLineItemId: $subscriptionLineItemId,\n      description: $description,\n      price: { amount: $amount, currencyCode: USD }\n    ) {\n      userErrors {\n        field\n        message\n      }\n      appUsageRecord {\n        id\n      }\n    }\n  }\n\\``}),`;\n`]})}),(0,s.jsxs)(e.p,{children:[\"This mutation take 3 arguments, the \",(0,s.jsx)(e.code,{children:\"subscriptionLineItemID\"}),\", the amount to charge, and a description of the usage.\"]}),(0,s.jsxs)(e.p,{children:[\"For this example we are not persisting the \",(0,s.jsx)(e.code,{children:\"subscriptionLineItemID\"}),\" in our database, so we will be fetching it from the Shopify API each time we need to create a usage record. In a production app you may want to persist this value in your database.\"]}),(0,s.jsxs)(e.p,{children:[\"Add the following GraphQL query to the same file that will be used to fetch the \",(0,s.jsx)(e.code,{children:\"subscriptionLineItemID\"}),\".\"]}),(0,s.jsx)(e.pre,{children:(0,s.jsxs)(e.code,{className:\"hljs language-javascript\",children:[(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-variable constant_\",children:\"HAS_PAYMENTS_QUERY\"}),\" = \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:`\\`\n    query appSubscription {\n        currentAppInstallation {\n            activeSubscriptions {\n                id\n                name\n                lineItems {\n                    id\n                    plan {\n                    pricingDetails {\n                        __typename\n                        ... on AppUsagePricing {\n                            terms\n                            balanceUsed {\n                                amount\n                            }\n                            cappedAmount {\n                                amount\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\\``}),`;\n`]})}),(0,s.jsxs)(e.p,{children:[\"Add the following function that will use the \",(0,s.jsx)(e.code,{children:\"HAS_PAYMENTS_QUERY\"}),\" to fetch the \",(0,s.jsx)(e.code,{children:\"subscriptionLineItemID\"}),\".\"]}),(0,s.jsx)(e.pre,{children:(0,s.jsxs)(e.code,{className:\"hljs language-javascript\",children:[(0,s.jsx)(e.span,{className:\"hljs-comment\",children:`/*\n * This function queries the API to get the app subscription line item ID by the\n * plan name and usage terms. You may want to store this ID in your database, but\n * for simplicity, we are querying the API for it here.\n */`}),`\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"async\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"function\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"getAppSubscription\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-params\",children:\"session\"}),`) {\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" client = \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"new\"}),\" shopify.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"api\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"clients\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"Graphql\"}),`({ session });\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"let\"}),` subscriptionLineItem = {};\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" planName = \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"Object\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"keys\"}),\"(billingConfig)[\",(0,s.jsx)(e.span,{className:\"hljs-number\",children:\"0\"}),`];\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" planDescription = billingConfig[planName].\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"usageTerms\"}),`;\n\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"try\"}),` {\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" response = \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"await\"}),\" client.\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"query\"}),`({\n      `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"data\"}),`: {\n        `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"query\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-variable constant_\",children:\"HAS_PAYMENTS_QUERY\"}),`,\n      },\n    });\n    response.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"body\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"data\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"currentAppInstallation\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"activeSubscriptions\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"forEach\"}),`(\n      `,(0,s.jsxs)(e.span,{className:\"hljs-function\",children:[\"(\",(0,s.jsx)(e.span,{className:\"hljs-params\",children:\"subscription\"}),\") =\u003e\"]}),` {\n        `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"if\"}),\" (subscription.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"name\"}),` === planName) {\n          subscription.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"lineItems\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"forEach\"}),\"(\",(0,s.jsxs)(e.span,{className:\"hljs-function\",children:[\"(\",(0,s.jsx)(e.span,{className:\"hljs-params\",children:\"lineItem\"}),\") =\u003e\"]}),` {\n            `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"if\"}),\" (lineItem.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"plan\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"pricingDetails\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"terms\"}),` === planDescription) {\n              subscriptionLineItem = {\n                `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"id\"}),\": lineItem.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"id\"}),`,\n                `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"balanceUsed\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-built_in\",children:\"parseFloat\"}),`(\n                  lineItem.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"plan\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"pricingDetails\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"balanceUsed\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"amount\"}),`\n                ),\n                `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"cappedAmount\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-built_in\",children:\"parseFloat\"}),`(\n                  lineItem.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"plan\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"pricingDetails\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"cappedAmount\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"amount\"}),`\n                ),\n              };\n            }\n          });\n        }\n      }\n    );\n  } `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"catch\"}),` (error) {\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"if\"}),\" (error \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"instanceof\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"GraphqlQueryError\"}),`) {\n      `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"throw\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"new\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"Error\"}),`(\n        `,(0,s.jsxs)(e.span,{className:\"hljs-string\",children:[\"`\",(0,s.jsx)(e.span,{className:\"hljs-subst\",children:\"${error.message}\"}),\"\\\\n\",(0,s.jsxs)(e.span,{className:\"hljs-subst\",children:[\"${\",(0,s.jsx)(e.span,{className:\"hljs-built_in\",children:\"JSON\"}),\".stringify(error.response, \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"null\"}),\", \",(0,s.jsx)(e.span,{className:\"hljs-number\",children:\"2\"}),\")}\"]}),\"`\"]}),`\n      );\n    } `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"else\"}),` {\n      `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"throw\"}),` error;\n    }\n  }\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"return\"}),` subscriptionLineItem;\n}\n`]})}),(0,s.jsxs)(e.p,{children:[\"Add the following function that will use the \",(0,s.jsx)(e.code,{children:\"CREATE_USAGE_RECORD\"}),\" mutation to create a usage record, and return the total amount in dollars of usage records that have been created.\"]}),(0,s.jsx)(e.pre,{children:(0,s.jsxs)(e.code,{className:\"hljs language-javascript\",children:[(0,s.jsx)(e.span,{className:\"hljs-comment\",children:`/*\n * This function creates a usage record for the app subscription.\n * To create a usage record, we need to know the app subscription line item ID.\n * You may want to store this ID in your database, but for simplicity, we are\n * querying the API for it here.\n * This function also returns the total amount in dollars of usage records that have been created.\n */`}),`\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"export\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"async\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"function\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"createUsageRecord\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-params\",children:\"session\"}),`) {\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" client = \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"new\"}),\" shopify.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"api\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"clients\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"Graphql\"}),`({ session });\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" subscriptionLineItem = \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"await\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"getAppSubscription\"}),`(session);\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" plan = \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"Object\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"keys\"}),\"(billingConfig)[\",(0,s.jsx)(e.span,{className:\"hljs-number\",children:\"0\"}),`];\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),` res = {\n    `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"capacityReached\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"false\"}),`,\n    `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"createdRecord\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"false\"}),`,\n  };\n\n  `,(0,s.jsx)(e.span,{className:\"hljs-comment\",children:\"// If the capacity has already been reached, we will not attempt to create the usage record\"}),`\n  `,(0,s.jsx)(e.span,{className:\"hljs-comment\",children:\"// On production shops, if you attempt to create a usage record and the capacity and been\"}),`\n  `,(0,s.jsx)(e.span,{className:\"hljs-comment\",children:\"// reached Shopify will return an error. On development shops, the usage record will be created\"}),`\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"if\"}),` (\n    subscriptionLineItem.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"balanceUsed\"}),\" + \",(0,s.jsx)(e.span,{className:\"hljs-variable constant_\",children:\"USAGE_CHARGE_INCREMENT_AMOUNT\"}),` \u003e\n    subscriptionLineItem.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"cappedAmount\"}),`\n  ) {\n    res.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"capacityReached\"}),\" = \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"true\"}),`;\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"return\"}),` res;\n  }\n\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"try\"}),` {\n    `,(0,s.jsx)(e.span,{className:\"hljs-comment\",children:\"// This makes an API call to Shopify to create a usage record\"}),`\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"await\"}),\" client.\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"query\"}),`({\n      `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"data\"}),`: {\n        `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"query\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-variable constant_\",children:\"CREATE_USAGE_RECORD\"}),`,\n        `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"variables\"}),`: {\n          `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"subscriptionLineItemId\"}),\": subscriptionLineItem.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"id\"}),`,\n          `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"amount\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-variable constant_\",children:\"USAGE_CHARGE_INCREMENT_AMOUNT\"}),`,\n          `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"description\"}),\": billingConfig[plan].\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"usageTerms\"}),`,\n        },\n      },\n    });\n    res.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"createdRecord\"}),\" = \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"true\"}),`;\n  } `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"catch\"}),` (error) {\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"if\"}),\" (error \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"instanceof\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"GraphqlQueryError\"}),`) {\n      `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"throw\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"new\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"Error\"}),`(\n        `,(0,s.jsxs)(e.span,{className:\"hljs-string\",children:[\"`\",(0,s.jsx)(e.span,{className:\"hljs-subst\",children:\"${error.message}\"}),\"\\\\n\",(0,s.jsxs)(e.span,{className:\"hljs-subst\",children:[\"${\",(0,s.jsx)(e.span,{className:\"hljs-built_in\",children:\"JSON\"}),\".stringify(error.response, \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"null\"}),\", \",(0,s.jsx)(e.span,{className:\"hljs-number\",children:\"2\"}),\")}\"]}),\"`\"]}),`\n      );\n    } `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"else\"}),` {\n      `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"throw\"}),` error;\n    }\n  }\n\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"if\"}),` (\n    subscriptionLineItem.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"balanceUsed\"}),\" + \",(0,s.jsx)(e.span,{className:\"hljs-variable constant_\",children:\"USAGE_CHARGE_INCREMENT_AMOUNT\"}),` \u003e=\n    subscriptionLineItem.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"cappedAmount\"}),`\n  ) {\n    res.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"capacityReached\"}),\" = \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"true\"}),`;\n  }\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"return\"}),` res;\n}\n`]})}),(0,s.jsxs)(e.p,{children:[\"Your \",(0,s.jsx)(e.code,{children:\"billing.js\"}),\" file should now look like this:\"]}),(0,s.jsx)(e.pre,{children:(0,s.jsxs)(e.code,{className:\"hljs language-javascript\",children:[(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"import\"}),\" { \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"GraphqlQueryError\"}),\", \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"BillingInterval\"}),\" } \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"from\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"@shopify/shopify-api\"'}),`;\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"import\"}),\" shopify \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"from\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"./shopify.js\"'}),`;\n\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-variable constant_\",children:\"USAGE_CHARGE_INCREMENT_AMOUNT\"}),\" = \",(0,s.jsx)(e.span,{className:\"hljs-number\",children:\"1.0\"}),`;\n\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"export\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),` billingConfig = {\n  `,(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"My plan\"'}),`: {\n    `,(0,s.jsx)(e.span,{className:\"hljs-comment\",children:\"// This is an example configuration that would do a one-time charge for $5 (only USD is currently supported)\"}),`\n    `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"amount\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-number\",children:\"5.0\"}),`,\n    `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"currencyCode\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"USD\"'}),`,\n    `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"interval\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"BillingInterval\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"Usage\"}),`,\n    `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"usageTerms\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"One dollar per button click\"'}),`,\n  },\n};\n\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"export\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"async\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"function\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"requestBilling\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-params\",children:\"res, next\"}),`) {\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" plans = \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"Object\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"keys\"}),`(billingConfig);\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" session = res.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"locals\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"shopify\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"session\"}),`;\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" hasPayment = \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"await\"}),\" shopify.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"api\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"billing\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"check\"}),`({\n    session,\n    `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"plans\"}),`: plans,\n    `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"isTest\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"true\"}),`,\n  });\n\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"if\"}),` (hasPayment) {\n    `,(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"next\"}),`();\n  } `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"else\"}),` {\n    res.`,(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"redirect\"}),`(\n      `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"await\"}),\" shopify.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"api\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"billing\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"request\"}),`({\n        session,\n        `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"plan\"}),\": plans[\",(0,s.jsx)(e.span,{className:\"hljs-number\",children:\"0\"}),`],\n        `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"isTest\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"true\"}),`,\n      })\n    );\n  }\n}\n\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-variable constant_\",children:\"CREATE_USAGE_RECORD\"}),\" = \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:`\\`\nmutation appUsageRecordCreate($subscriptionLineItemId: ID!, $amount: Decimal!, $description: String!){\n    appUsageRecordCreate(\n      subscriptionLineItemId: $subscriptionLineItemId,\n      description: $description,\n      price: { amount: $amount, currencyCode: USD }\n    ) {\n      userErrors {\n        field\n        message\n      }\n      appUsageRecord {\n        id\n      }\n    }\n  }\n\\``}),`;\n\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-variable constant_\",children:\"HAS_PAYMENTS_QUERY\"}),\" = \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:`\\`\nquery appSubscription {\n  currentAppInstallation {\n    activeSubscriptions {\n          id\n          name\n          lineItems {\n                id\n                plan {\n                  pricingDetails {\n                    __typename\n                    ... on AppUsagePricing {\n                      terms\n                      balanceUsed {\n                        amount\n                      }\n                      cappedAmount {\n                        amount\n                      }\n                    }\n                  }\n                }\n              }\n          }\n        }\n    }\n\\``}),`;\n`,(0,s.jsx)(e.span,{className:\"hljs-comment\",children:`/*\n * This function creates a usage record for the app subscription.\n * To create a usage record, we need to know the app subscription line item ID.\n * You may want to store this ID in your database, but for simplicity, we are\n * querying the API for it here.\n */`}),`\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"export\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"async\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"function\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"createUsageRecord\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-params\",children:\"session\"}),`) {\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" client = \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"new\"}),\" shopify.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"api\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"clients\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"Graphql\"}),`({ session });\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" subscriptionLineItem = \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"await\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"getAppSubscription\"}),`(session);\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" plan = \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"Object\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"keys\"}),\"(billingConfig)[\",(0,s.jsx)(e.span,{className:\"hljs-number\",children:\"0\"}),`];\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),` res = {\n    `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"capacityReached\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"false\"}),`,\n    `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"createdRecord\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"false\"}),`,\n  };\n\n  `,(0,s.jsx)(e.span,{className:\"hljs-comment\",children:\"// If the capacity has already been reached, we will not attempt to create the usage record\"}),`\n  `,(0,s.jsx)(e.span,{className:\"hljs-comment\",children:\"// On production shops, if you attempt to create a usage record and the capacity and been\"}),`\n  `,(0,s.jsx)(e.span,{className:\"hljs-comment\",children:\"// reached Shopify will return an error. On development shops, the usage record will be created\"}),`\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"if\"}),` (\n    subscriptionLineItem.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"balanceUsed\"}),\" + \",(0,s.jsx)(e.span,{className:\"hljs-variable constant_\",children:\"USAGE_CHARGE_INCREMENT_AMOUNT\"}),` \u003e\n    subscriptionLineItem.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"cappedAmount\"}),`\n  ) {\n    res.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"capacityReached\"}),\" = \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"true\"}),`;\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"return\"}),` res;\n  }\n\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"try\"}),` {\n    `,(0,s.jsx)(e.span,{className:\"hljs-comment\",children:\"// This makes an API call to Shopify to create a usage record\"}),`\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"await\"}),\" client.\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"query\"}),`({\n      `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"data\"}),`: {\n        `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"query\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-variable constant_\",children:\"CREATE_USAGE_RECORD\"}),`,\n        `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"variables\"}),`: {\n          `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"subscriptionLineItemId\"}),\": subscriptionLineItem.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"id\"}),`,\n          `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"amount\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-variable constant_\",children:\"USAGE_CHARGE_INCREMENT_AMOUNT\"}),`,\n          `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"description\"}),\": billingConfig[plan].\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"usageTerms\"}),`,\n        },\n      },\n    });\n    res.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"createdRecord\"}),\" = \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"true\"}),`;\n  } `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"catch\"}),` (error) {\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"if\"}),\" (error \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"instanceof\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"GraphqlQueryError\"}),`) {\n      `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"throw\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"new\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"Error\"}),`(\n        `,(0,s.jsxs)(e.span,{className:\"hljs-string\",children:[\"`\",(0,s.jsx)(e.span,{className:\"hljs-subst\",children:\"${error.message}\"}),\"\\\\n\",(0,s.jsxs)(e.span,{className:\"hljs-subst\",children:[\"${\",(0,s.jsx)(e.span,{className:\"hljs-built_in\",children:\"JSON\"}),\".stringify(error.response, \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"null\"}),\", \",(0,s.jsx)(e.span,{className:\"hljs-number\",children:\"2\"}),\")}\"]}),\"`\"]}),`\n      );\n    } `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"else\"}),` {\n      `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"throw\"}),` error;\n    }\n  }\n\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"if\"}),` (\n    subscriptionLineItem.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"balanceUsed\"}),\" + \",(0,s.jsx)(e.span,{className:\"hljs-variable constant_\",children:\"USAGE_CHARGE_INCREMENT_AMOUNT\"}),` \u003e=\n    subscriptionLineItem.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"cappedAmount\"}),`\n  ) {\n    res.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"capacityReached\"}),\" = \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"true\"}),`;\n  }\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"return\"}),` res;\n}\n\n`,(0,s.jsx)(e.span,{className:\"hljs-comment\",children:`/*\n * This function queries the API to get the app subscription line item ID by the\n * plan name and usage terms. You may want to store this ID in your database, but\n * for simplicity, we are querying the API for it here.\n */`}),`\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"async\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"function\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"getAppSubscription\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-params\",children:\"session\"}),`) {\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" client = \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"new\"}),\" shopify.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"api\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"clients\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"Graphql\"}),`({ session });\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"let\"}),` subscriptionLineItem = {};\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" planName = \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"Object\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"keys\"}),\"(billingConfig)[\",(0,s.jsx)(e.span,{className:\"hljs-number\",children:\"0\"}),`];\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" planDescription = billingConfig[planName].\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"usageTerms\"}),`;\n\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"try\"}),` {\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" response = \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"await\"}),\" client.\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"query\"}),`({\n      `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"data\"}),`: {\n        `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"query\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-variable constant_\",children:\"HAS_PAYMENTS_QUERY\"}),`,\n      },\n    });\n    response.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"body\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"data\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"currentAppInstallation\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"activeSubscriptions\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"forEach\"}),`(\n      `,(0,s.jsxs)(e.span,{className:\"hljs-function\",children:[\"(\",(0,s.jsx)(e.span,{className:\"hljs-params\",children:\"subscription\"}),\") =\u003e\"]}),` {\n        `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"if\"}),\" (subscription.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"name\"}),` === planName) {\n          subscription.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"lineItems\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"forEach\"}),\"(\",(0,s.jsxs)(e.span,{className:\"hljs-function\",children:[\"(\",(0,s.jsx)(e.span,{className:\"hljs-params\",children:\"lineItem\"}),\") =\u003e\"]}),` {\n            `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"if\"}),\" (lineItem.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"plan\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"pricingDetails\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"terms\"}),` === planDescription) {\n              subscriptionLineItem = {\n                `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"id\"}),\": lineItem.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"id\"}),`,\n                `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"balanceUsed\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-built_in\",children:\"parseFloat\"}),`(\n                  lineItem.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"plan\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"pricingDetails\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"balanceUsed\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"amount\"}),`\n                ),\n                `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"cappedAmount\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-built_in\",children:\"parseFloat\"}),`(\n                  lineItem.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"plan\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"pricingDetails\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"cappedAmount\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"amount\"}),`\n                ),\n              };\n            }\n          });\n        }\n      }\n    );\n  } `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"catch\"}),` (error) {\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"if\"}),\" (error \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"instanceof\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"GraphqlQueryError\"}),`) {\n      `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"throw\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"new\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"Error\"}),`(\n        `,(0,s.jsxs)(e.span,{className:\"hljs-string\",children:[\"`\",(0,s.jsx)(e.span,{className:\"hljs-subst\",children:\"${error.message}\"}),\"\\\\n\",(0,s.jsxs)(e.span,{className:\"hljs-subst\",children:[\"${\",(0,s.jsx)(e.span,{className:\"hljs-built_in\",children:\"JSON\"}),\".stringify(error.response, \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"null\"}),\", \",(0,s.jsx)(e.span,{className:\"hljs-number\",children:\"2\"}),\")}\"]}),\"`\"]}),`\n      );\n    } `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"else\"}),` {\n      `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"throw\"}),` error;\n    }\n  }\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"return\"}),` subscriptionLineItem;\n}\n`]})}),(0,s.jsxs)(e.p,{children:[\"In the \",(0,s.jsx)(e.code,{children:\"web/index.js\"}),\" file, add the following code to the create the API route that will call the newly created functions to create a usage record and check if the capacity has been reached:\"]}),(0,s.jsx)(e.pre,{children:(0,s.jsxs)(e.code,{className:\"hljs language-javascript\",children:[\"app.\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"get\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"/api/usage/create\"'}),\", \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"async\"}),` (_req, res) =\u003e {\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"let\"}),\" status = \",(0,s.jsx)(e.span,{className:\"hljs-number\",children:\"200\"}),`;\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"let\"}),\" error = \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"null\"}),`;\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"let\"}),\" resp = \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"null\"}),`;\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"let\"}),\" capacityReached = \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"false\"}),`;\n\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"try\"}),` {\n    resp = `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"await\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"createUsageRecord\"}),\"(res.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"locals\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"shopify\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"session\"}),`);\n    capacityReached = resp.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"capacityReached\"}),`;\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"if\"}),\" (capacityReached \u0026\u0026 !resp.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"createdRecord\"}),`) {\n      error = `,(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"Could not create record because capacity was reached\"'}),`;\n      status = `,(0,s.jsx)(e.span,{className:\"hljs-number\",children:\"400\"}),`;\n    }\n  } `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"catch\"}),` (e) {\n    `,(0,s.jsx)(e.span,{className:\"hljs-variable language_\",children:\"console\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"log\"}),\"(\",(0,s.jsxs)(e.span,{className:\"hljs-string\",children:[\"`Failed to process usage/create: \",(0,s.jsx)(e.span,{className:\"hljs-subst\",children:\"${e.message}\"}),\"`\"]}),`);\n    status = `,(0,s.jsx)(e.span,{className:\"hljs-number\",children:\"500\"}),`;\n    error = e.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"message\"}),`;\n  }\n  res\n    .`,(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"status\"}),`(status)\n    .`,(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"send\"}),\"({ \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"success\"}),\": status === \",(0,s.jsx)(e.span,{className:\"hljs-number\",children:\"200\"}),\", \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"capacityReach\"}),`: capacityReached, error });\n});\n`]})}),(0,s.jsx)(e.h3,{children:\"Test the App\"}),(0,s.jsxs)(e.p,{children:[\"If you would like to test the install flow again you can uninstall your app from your Shopify admin in \",(0,s.jsx)(e.code,{children:\"Apps\"}),\" \u003e \",(0,s.jsx)(e.code,{children:\"Apps and Sales Channels Settings\"}),\" \u003e \",(0,s.jsx)(e.code,{children:\"Remove\"}),\".\"]}),(0,s.jsxs)(e.p,{children:[\"You can install your app by clicking the install link that was output when you ran \",(0,s.jsx)(e.code,{children:\"npm run dev\"}),\" in the terminal.\"]}),(0,s.jsx)(e.p,{children:\"After approving the scopes, you should be redirected to the billing page. After approving the test charge you are then directed to the apps home page.\"}),(0,s.jsxs)(e.p,{children:[\"On the apps home page, you can click the \",(0,s.jsx)(e.code,{children:\"Create Usage Record\"}),\" button to create a usage record. If you have not reached the capacity, you should see a success message. If you have reached the capacity, you should see an error message.\"]}),(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:\"/content/images/optimized/usage-billing/usage-billing-frontend.jpg\",alt:\"usage-frontend\"})}),(0,s.jsxs)(e.p,{children:[\"In the Shopify Admin navigate to \",(0,s.jsx)(e.code,{children:\"Settings\"}),\" \u003e \",(0,s.jsx)(e.code,{children:\"Billing\"}),\" \u003e \",(0,s.jsx)(e.code,{children:\"Subscriptions\"}),\" \u003e \",(0,s.jsx)(e.code,{children:\"View All\"}),\" \u003e \",(0,s.jsx)(e.code,{children:\"Your App Name\"}),\" \u003e \",(0,s.jsx)(e.code,{children:\"View Spending Limit\"}),\". You should now see the usage record that was created, and maximum amount that can be charge.\"]}),(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:\"/content/images/optimized/usage-billing/spending-limit.jpg\",alt:\"spending-limit\"})}),(0,s.jsxs)(e.dl,{children:[(0,s.jsx)(e.dt,{children:\"Negative\"}),(0,s.jsx)(e.dd,{children:\"This app relies on an uninstall webhook to delete the API key from the SQLite database. When uninstalling and installing rapidly you may encounter cases when the webhook was not processed in time. If you encounter this issue, you can manually delete the API key from the database. Installing a plugin for managing SQLite databases can be helpful for this.\"})]})]})}),(0,s.jsx)(e.div,{className:\"workshop-step\",children:(0,s.jsxs)(e.section,{children:[(0,s.jsx)(e.h2,{id:\"6\",children:\"Prompting a Merchant to Upgrade\"}),(0,s.jsx)(e.p,{children:\"When a merchant reaches the maximum usage capacity as defined in the billing plan, you may want to disable all or portions of your app. You can prompt them to increase the maximum amount they can be charged, to continue making usage records.\"}),(0,s.jsx)(e.h3,{children:\"Disabling the Usage Charge Button\"}),(0,s.jsxs)(e.p,{children:[\"In the \",(0,s.jsx)(e.code,{children:\"web/frontend/components/PaidFeatures.jsx\"}),\" we will add a state variable to the component to track if the merchant has reached the capacity. And disable the button if the capacity has been reached.\"]}),(0,s.jsxs)(e.p,{children:[\"The \",(0,s.jsx)(e.code,{children:\"PaidFeatures.jsx\"}),\" component should look like this:\"]}),(0,s.jsx)(e.pre,{children:(0,s.jsxs)(e.code,{className:\"hljs language-javascript\",children:[(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"import\"}),\" { useState } \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"from\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"react\"'}),`;\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"import\"}),\" { \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"Card\"}),\" } \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"from\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"@shopify/polaris\"'}),`;\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"import\"}),\" { \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"Toast\"}),\" } \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"from\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"@shopify/app-bridge-react\"'}),`;\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"import\"}),\" { useAuthenticatedFetch } \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"from\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"../hooks\"'}),`;\n\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"export\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"function\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"PaidFeature\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-params\"}),`) {\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" [isLoading, setIsLoading] = \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"useState\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"false\"}),`);\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" [toastProps, setToastProps] = \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"useState\"}),\"({ \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"content\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"null\"}),` });\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" [capacityReached, setCapacityReached] = \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"useState\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"false\"}),`);\n\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" fetch = \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"useAuthenticatedFetch\"}),`();\n\n  `,(0,s.jsx)(e.span,{className:\"hljs-comment\",children:`/*\n   * This will use the authenticated fetch hook to make a request to our server\n   * to create a usage record. If the usage record is created successfully, we\n   * will set the toastProps to display a success message. If the usage record\n   * is not created successfully, we will set the toastProps to display an error\n   * If the usage record is not created successfully because the capacity has\n   * been reached, we will set the capacityReached state to true so that the\n   * button is disabled.\n   */`}),`\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"handleCreateUsageRecord\"}),\" = \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"async\"}),\" (\",(0,s.jsx)(e.span,{className:\"hljs-params\"}),`) =\u003e {\n    `,(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"setIsLoading\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"true\"}),`);\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" response = \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"await\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"fetch\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"/api/usage/create\"'}),`);\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" body = \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"await\"}),\" response.\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"json\"}),`();\n    body.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"capacityReach\"}),\" ? \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"setCapacityReached\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"true\"}),\") : \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"setCapacityReached\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"false\"}),`);\n    `,(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"setIsLoading\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"false\"}),`);\n\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"if\"}),\" (response.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"ok\"}),`) {\n      `,(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"setToastProps\"}),\"({ \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"content\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"Usage record created!\"'}),` });\n    } `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"else\"}),` {\n      `,(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"setToastProps\"}),`({\n        `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"content\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"There was an error creating usage record\"'}),`,\n        `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"error\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"true\"}),`,\n      });\n    }\n  };\n\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" toastMarkup = toastProps.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"content\"}),` \u0026\u0026 (\n    `,(0,s.jsxs)(e.span,{className:\"xml\",children:[(0,s.jsxs)(e.span,{className:\"hljs-tag\",children:[\"\u003c\",(0,s.jsx)(e.span,{className:\"hljs-name\",children:\"Toast\"}),\" {\",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"...toastProps\"}),\"} \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"onDismiss\"}),\"=\",(0,s.jsx)(e.span,{className:\"hljs-string\",children:\"{()\"}),\" =\u003e\"]}),\" setToastProps({ content: null })} /\u003e\"]}),`\n  );\n\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"return\"}),` (\n    `,(0,s.jsxs)(e.span,{className:\"xml\",children:[(0,s.jsx)(e.span,{className:\"hljs-tag\",children:\"\u003c\u003e\"}),`\n      {toastMarkup}\n      `,(0,s.jsxs)(e.span,{className:\"hljs-tag\",children:[\"\u003c\",(0,s.jsx)(e.span,{className:\"hljs-name\",children:\"Card\"}),`\n        `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"title\"}),\"=\",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"Usage Billing\"'}),`\n        `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"sectioned\"}),`\n        `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"primaryFooterAction\"}),\"=\",(0,s.jsx)(e.span,{className:\"hljs-string\",children:\"{{\"}),`\n          `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"content:\"}),' \"',(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"Create\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"Usage\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"Record\"}),`\",\n          `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"onAction:\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"handleCreateUsageRecord\"}),`,\n          `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"loading:\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"isLoading\"}),`,\n          `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"disabled:\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"capacityReached\"}),`,\n        }}\n      \u003e`]}),`\n        {capacityReached ? (\n          `,(0,s.jsxs)(e.span,{className:\"hljs-tag\",children:[\"\u003c\",(0,s.jsx)(e.span,{className:\"hljs-name\",children:\"p\"}),\"\u003e\"]}),`\n            To continue using this feature please update maximum usage charge\n            limits\n          `,(0,s.jsxs)(e.span,{className:\"hljs-tag\",children:[\"\u003c/\",(0,s.jsx)(e.span,{className:\"hljs-name\",children:\"p\"}),\"\u003e\"]}),`\n        ) : (\n          `,(0,s.jsxs)(e.span,{className:\"hljs-tag\",children:[\"\u003c\",(0,s.jsx)(e.span,{className:\"hljs-name\",children:\"p\"}),\"\u003e\"]}),\"Use this feature! (Will be charged for usage)\",(0,s.jsxs)(e.span,{className:\"hljs-tag\",children:[\"\u003c/\",(0,s.jsx)(e.span,{className:\"hljs-name\",children:\"p\"}),\"\u003e\"]}),`\n        )}\n      `,(0,s.jsxs)(e.span,{className:\"hljs-tag\",children:[\"\u003c/\",(0,s.jsx)(e.span,{className:\"hljs-name\",children:\"Card\"}),\"\u003e\"]}),`\n    `,(0,s.jsx)(e.span,{className:\"hljs-tag\",children:\"\u003c/\u003e\"})]}),`\n  );\n}\n`]})}),(0,s.jsx)(e.h3,{children:\"Prompting a Merchant to Upgrade\"}),(0,s.jsx)(e.p,{children:\"In the Shopify Admin in the App Subscription settings we were able to view how much capacity has been used and the maximum amount that can be charged. This is also the same place a merchant can update the maximum amount that can be charged.\"}),(0,s.jsx)(e.p,{children:\"We will use the Shopify App Bridge library to provide a link to the App Subscription settings in the app.\"}),(0,s.jsxs)(e.p,{children:[\"In the \",(0,s.jsx)(e.code,{children:\"web/frontend/components/PaidFeatures.jsx\"}),\" file, add the following code to the \",(0,s.jsx)(e.code,{children:\"PaidFeature\"}),\" component:\"]}),(0,s.jsx)(e.pre,{children:(0,s.jsxs)(e.code,{className:\"hljs language-javascript\",children:[(0,s.jsx)(e.span,{className:\"hljs-comment\",children:`/*\n * This uses AppBridge to open the  app subscription management page\n * in the Shopify Admin.\n */`}),`\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"handleNavigateToSubscriptionPage\"}),\" = (\",(0,s.jsx)(e.span,{className:\"hljs-params\"}),`) =\u003e {\n  `,(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"navigate\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"/settings/billing/subscriptions\"'}),`, {\n    `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"replace\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"true\"}),`,\n    `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"target\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"host\"'}),`,\n  });\n};\n`]})}),(0,s.jsxs)(e.p,{children:[\"And update the text showed on the \",(0,s.jsx)(e.code,{children:\"Card\"}),\" component to include a link to the App Subscription settings:\"]}),(0,s.jsx)(e.pre,{children:(0,s.jsxs)(e.code,{className:\"hljs language-javascript\",children:[`{\n  capacityReached ? (\n    `,(0,s.jsxs)(e.span,{className:\"xml\",children:[(0,s.jsxs)(e.span,{className:\"hljs-tag\",children:[\"\u003c\",(0,s.jsx)(e.span,{className:\"hljs-name\",children:\"Link\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"onClick\"}),\"=\",(0,s.jsx)(e.span,{className:\"hljs-string\",children:\"{handleNavigateToSubscriptionPage}\"}),\"\u003e\"]}),`\n      To continue using this feature please update maximum usage charge limits\n    `,(0,s.jsxs)(e.span,{className:\"hljs-tag\",children:[\"\u003c/\",(0,s.jsx)(e.span,{className:\"hljs-name\",children:\"Link\"}),\"\u003e\"]})]}),`\n  ) : (\n    `,(0,s.jsxs)(e.span,{className:\"xml\",children:[(0,s.jsxs)(e.span,{className:\"hljs-tag\",children:[\"\u003c\",(0,s.jsx)(e.span,{className:\"hljs-name\",children:\"p\"}),\"\u003e\"]}),\"Use this feature! (Will be charged for usage)\",(0,s.jsxs)(e.span,{className:\"hljs-tag\",children:[\"\u003c/\",(0,s.jsx)(e.span,{className:\"hljs-name\",children:\"p\"}),\"\u003e\"]})]}),`\n  );\n}\n`]})}),(0,s.jsxs)(e.p,{children:[\"The \",(0,s.jsx)(e.code,{children:\"PaidFeatures.jsx\"}),\" component should now look like this:\"]}),(0,s.jsx)(e.pre,{children:(0,s.jsxs)(e.code,{className:\"hljs language-javascript\",children:[(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"import\"}),\" { useState } \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"from\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"react\"'}),`;\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"import\"}),\" { \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"Card\"}),\", \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"Link\"}),\" } \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"from\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"@shopify/polaris\"'}),`;\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"import\"}),\" { \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"Toast\"}),\", useNavigate } \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"from\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"@shopify/app-bridge-react\"'}),`;\n\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"import\"}),\" { useAuthenticatedFetch } \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"from\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"../hooks\"'}),`;\n\n`,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"export\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"function\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"PaidFeature\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-params\"}),`) {\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" [isLoading, setIsLoading] = \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"useState\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"false\"}),`);\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" [toastProps, setToastProps] = \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"useState\"}),\"({ \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"content\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"null\"}),` });\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" [capacityReached, setCapacityReached] = \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"useState\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"false\"}),`);\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" navigate = \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"useNavigate\"}),`();\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" fetch = \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"useAuthenticatedFetch\"}),`();\n\n  `,(0,s.jsx)(e.span,{className:\"hljs-comment\",children:`/*\n   * This will use the authenticated fetch hook to make a request to our server\n   * to create a usage record. If the usage record is created successfully, we\n   * will set the toastProps to display a success message. If the usage record\n   * is not created successfully, we will set the toastProps to display an error\n   * If the usage record is not created successfully because the capacity has\n   * been reached, we will set the capacityReached state to true so that the\n   * button is disabled.\n   */`}),`\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"handleCreateUsageRecord\"}),\" = \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"async\"}),\" (\",(0,s.jsx)(e.span,{className:\"hljs-params\"}),`) =\u003e {\n    `,(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"setIsLoading\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"true\"}),`);\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" response = \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"await\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"fetch\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"/api/usage/create\"'}),`);\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" body = \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"await\"}),\" response.\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"json\"}),`();\n    body.`,(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"capacityReach\"}),\" ? \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"setCapacityReached\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"true\"}),\") : \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"setCapacityReached\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"false\"}),`);\n    `,(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"setIsLoading\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"false\"}),`);\n\n    `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"if\"}),\" (response.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"ok\"}),`) {\n      `,(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"setToastProps\"}),\"({ \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"content\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"Usage record created!\"'}),` });\n    } `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"else\"}),` {\n      `,(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"setToastProps\"}),`({\n        `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"content\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"There was an error creating usage record\"'}),`,\n        `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"error\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"true\"}),`,\n      });\n    }\n  };\n\n  `,(0,s.jsx)(e.span,{className:\"hljs-comment\",children:`/*\n   * This uses AppBridge to open the  app subscription management page\n   * in the Shopify Admin.\n   */`}),`\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"handleNavigateToSubscriptionPage\"}),\" = (\",(0,s.jsx)(e.span,{className:\"hljs-params\"}),`) =\u003e {\n    `,(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"navigate\"}),\"(\",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"/settings/billing/subscriptions\"'}),`, {\n      `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"replace\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-literal\",children:\"true\"}),`,\n      `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"target\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"host\"'}),`,\n    });\n  };\n\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" toastMarkup = toastProps.\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"content\"}),` \u0026\u0026 (\n    `,(0,s.jsxs)(e.span,{className:\"xml\",children:[(0,s.jsxs)(e.span,{className:\"hljs-tag\",children:[\"\u003c\",(0,s.jsx)(e.span,{className:\"hljs-name\",children:\"Toast\"}),\" {\",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"...toastProps\"}),\"} \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"onDismiss\"}),\"=\",(0,s.jsx)(e.span,{className:\"hljs-string\",children:\"{()\"}),\" =\u003e\"]}),\" setToastProps({ content: null })} /\u003e\"]}),`\n  );\n\n  `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"return\"}),` (\n    `,(0,s.jsxs)(e.span,{className:\"xml\",children:[(0,s.jsx)(e.span,{className:\"hljs-tag\",children:\"\u003c\u003e\"}),`\n      {toastMarkup}\n      `,(0,s.jsxs)(e.span,{className:\"hljs-tag\",children:[\"\u003c\",(0,s.jsx)(e.span,{className:\"hljs-name\",children:\"Card\"}),`\n        `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"title\"}),\"=\",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"Usage Billing\"'}),`\n        `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"sectioned\"}),`\n        `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"primaryFooterAction\"}),\"=\",(0,s.jsx)(e.span,{className:\"hljs-string\",children:\"{{\"}),`\n          `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"content:\"}),' \"',(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"Create\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"Usage\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"Record\"}),`\",\n          `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"onAction:\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"handleCreateUsageRecord\"}),`,\n          `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"loading:\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"isLoading\"}),`,\n          `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"disabled:\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"capacityReached\"}),`,\n        }}\n      \u003e`]}),`\n        {capacityReached ? (\n          `,(0,s.jsxs)(e.span,{className:\"hljs-tag\",children:[\"\u003c\",(0,s.jsx)(e.span,{className:\"hljs-name\",children:\"Link\"}),\" \",(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"onClick\"}),\"=\",(0,s.jsx)(e.span,{className:\"hljs-string\",children:\"{handleNavigateToSubscriptionPage}\"}),\"\u003e\"]}),`\n            To continue using this feature please update maximum usage charge\n            limits\n          `,(0,s.jsxs)(e.span,{className:\"hljs-tag\",children:[\"\u003c/\",(0,s.jsx)(e.span,{className:\"hljs-name\",children:\"Link\"}),\"\u003e\"]}),`\n        ) : (\n          `,(0,s.jsxs)(e.span,{className:\"hljs-tag\",children:[\"\u003c\",(0,s.jsx)(e.span,{className:\"hljs-name\",children:\"p\"}),\"\u003e\"]}),\"Use this feature! (Will be charged for usage)\",(0,s.jsxs)(e.span,{className:\"hljs-tag\",children:[\"\u003c/\",(0,s.jsx)(e.span,{className:\"hljs-name\",children:\"p\"}),\"\u003e\"]}),`\n        )}\n      `,(0,s.jsxs)(e.span,{className:\"hljs-tag\",children:[\"\u003c/\",(0,s.jsx)(e.span,{className:\"hljs-name\",children:\"Card\"}),\"\u003e\"]}),`\n    `,(0,s.jsx)(e.span,{className:\"hljs-tag\",children:\"\u003c/\u003e\"})]}),`\n  );\n}\n`]})}),(0,s.jsx)(e.p,{children:\"Now once merchants reach the maximum amount of usage that can be charged, they will be able to click the link to update the maximum amount that can be charged.\"}),(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:\"/content/images/usage-billing/increase-max.gif\",alt:\"increase-max\"})})]})}),(0,s.jsx)(e.div,{className:\"workshop-step\",children:(0,s.jsxs)(e.section,{children:[(0,s.jsx)(e.h2,{id:\"7\",children:\"Subscribing to Webhooks\"}),(0,s.jsx)(e.p,{children:\"There are several webhooks that you can subscribe to remain updated on the usage charge subscription.\"}),(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.a,{href:\"https://shopify.dev/api/admin-graphql/2022-10/enums/WebhookSubscriptionTopic#value-appsubscriptionsupdate\",children:\"APP_SUBSCRIPTIONS_UPDATE\"}),\" will be triggered when a merchant updates the maximum amount that can be charged. If you are storing information about the app subscription in your database, you can update the information in your database when this webhook is triggered.\"]}),(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.a,{href:\"https://shopify.dev/api/admin-graphql/2022-10/enums/WebhookSubscriptionTopic#value-appsubscriptionsapproachingcappedamount\",children:\"APP_SUBSCRIPTIONS_APPROACHING_CAPPED_AMOUNT\"}),\" will be triggered when the balance used on an app subscription crosses 90% of the capped amount. You can use this webhook to send a notification to the merchant to let them know that they are approaching the maximum amount that can be charged.\"]}),(0,s.jsxs)(e.p,{children:[\"To subscribe to a new webhook in the provided app template, add the following code to the \",(0,s.jsx)(e.code,{children:\"gdpr.js\"}),\" file:\"]}),(0,s.jsx)(e.pre,{children:(0,s.jsxs)(e.code,{className:\"hljs language-javascript\",children:[(0,s.jsx)(e.span,{className:\"hljs-comment\",children:\"//...\"}),`\n  `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"APP_SUBSCRIPTIONS_UPDATE\"}),`: {\n    `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"deliveryMethod\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"DeliveryMethod\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-property\",children:\"Http\"}),`,\n    `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"callbackUrl\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"/api/webhooks\"'}),`,\n    `,(0,s.jsx)(e.span,{className:\"hljs-attr\",children:\"callback\"}),\": \",(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"async\"}),` (topic, shop, body, webhookId) =\u003e {\n      `,(0,s.jsx)(e.span,{className:\"hljs-keyword\",children:\"const\"}),\" payload = \",(0,s.jsx)(e.span,{className:\"hljs-title class_\",children:\"JSON\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"parse\"}),`(body);\n      `,(0,s.jsx)(e.span,{className:\"hljs-variable language_\",children:\"console\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"log\"}),\"(shop, \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"shop\"'}),`);\n      `,(0,s.jsx)(e.span,{className:\"hljs-variable language_\",children:\"console\"}),\".\",(0,s.jsx)(e.span,{className:\"hljs-title function_\",children:\"log\"}),\"(payload, \",(0,s.jsx)(e.span,{className:\"hljs-string\",children:'\"payload\"'}),`);\n    }\n  },\n`,(0,s.jsx)(e.span,{className:\"hljs-comment\",children:\"//\"}),`\n`]})}),(0,s.jsx)(e.p,{children:\"Reinstall your app and in the terminal you should now see output when a merchant updates the maximum amount that can be charged.\"}),(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.a,{href:\"https://github.com/Shopify/shopify-api-js/blob/main/docs/guides/webhooks.md\",children:\"Learn more about subscribing to webhooks\"}),\" with the Shopify Node API.\"]})]})}),(0,s.jsx)(e.div,{className:\"workshop-step\",children:(0,s.jsxs)(e.section,{children:[(0,s.jsx)(e.h2,{id:\"8\",children:\"Conclusion\"}),(0,s.jsxs)(e.p,{children:[\"After completing this workshop you should now have experience with creating an app with the \",(0,s.jsx)(e.a,{href:\"https://shopify.dev/apps/tools/cli\",children:\"Shopify CLI\"}),\", creating a usage based subscription billing plan, creating usage records and subscribing to webhooks with the \",(0,s.jsx)(e.a,{href:\"https://github.com/Shopify/shopify-api-js\",children:\"Shopify Node API\"}),\", and using the \",(0,s.jsx)(e.a,{href:\"https://shopify.dev/apps/tools/app-bridge\",children:\"App Bridge React library\"}),\" to navigate to the App Subscription settings in the Shopify Admin.\"]}),(0,s.jsxs)(e.dl,{children:[(0,s.jsx)(e.dt,{children:\"Positive\"}),(0,s.jsxs)(e.dd,{children:[\"If you would like to see the completed code for this workshop, you can find it on \",(0,s.jsx)(e.a,{href:\"https://github.com/Shopify/usage-billing-example-shopify-app\",children:\"GitHub\"}),\".\"]})]}),(0,s.jsx)(e.h3,{children:\"Next Steps\"}),(0,s.jsxs)(e.p,{children:[\"To continue your learning on the Shopify Billing API, review the \",(0,s.jsx)(e.a,{href:\"https://shopify.dev/apps/billing\",children:\"Shopify Billing API documentation\"}),\".\"]})]})})]})]})}function k(a={}){let{wrapper:e}=a.components||{};return e?(0,s.jsx)(e,Object.assign({},a,{children:(0,s.jsx)(o,a)})):o(a)}var _=k;function p(a,e){throw new Error(\"Expected \"+(e?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return w(I);})();\n;return Component;","frontmatter":{"id":"usage-billing","title":"Usage Billing with the Shopify Billing API","summary":"Implement usage based billing using the Billing API.","status":"Published","categories":"shopify"},"trackingEnabled":true},"routes/workshops":null},"actionData":null,"errors":null},"future":{"v2_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":false,"v2_headers":false,"v2_meta":false,"v2_normalizeFormMethod":false,"v2_routeConvention":false}};</script><script type="module" async="">import "/build/manifest-0FD511F1.js";
import * as route0 from "/build/root-TS7GWK7I.js";
import * as route1 from "/build/routes/workshops-YWZAAF22.js";
import * as route2 from "/build/routes/workshops/$workshopId-TCVFMZD7.js";
window.__remixRouteModules = {"root":route0,"routes/workshops":route1,"routes/workshops/$workshopId":route2};

import("/build/entry.client-J6TYPMOL.js");</script></body></html>